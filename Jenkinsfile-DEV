pipeline {
    agent any 
    
    stages {
           stage('SCM Checkout') {
               steps {
               git credentialsId: 'GIT_CREDENTIALS', url: 'https://github.com/WajidAli3301/spring-boot-mongo-docker.git'
              }
           }
           
           stage ('Build') {
              steps {
                  sh "mvn clean verify sonar:sonar"
           }
           post {
                success {
                    echo "Successful build service"
                }
               
            }   
        }       
        stage ('Artifact Build and Push') {
             steps {
                 sh "echo Start Docker build"
                 sh "sudo docker image build -t 2496/app ."
                 sh "echo Pushing latest image"
                 sh "sudo docker push 2496/app"
                 sh "echo TAG ${BUILD_NUMBER}"
                 sh "sudo docker tag 2496/app 2496/app:${BUILD_NO}"
                 sh "echo pushing image with tag"
                 sh "sudo docker push 2496/app:${BUILD_NO}"
             }
             post {
                 success {
                     echo "Successful pushed artificat to docker hub registry"
                 }
             }
           
        }
  
     
   }
}
 
